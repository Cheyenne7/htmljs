{
  "name": "weibov2",
  "description": "改进的nodejs新浪微博SDK",
  "version": "0.9.3",
  "keywords": "weibo sina sdk",
  "contributors": [
    {
      "name": "yutou",
      "email": "xinyu198736@gmail.com"
    }
  ],
  "main": "./lib/weibo2.js",
  "licenses": [
    {
      "type": "GPLv2",
      "url": "http://www.example.com/licenses/gpl.html"
    }
  ],
  "repositories": "https://github.com/xinyu198736/node-weibov2",
  "dependencies": {},
  "readme": "node-weibov2\n============\n\n基于node-weibo-v2改进的node平台微博v2接口sdk\n\n#安装\n\n  npm install weibov2\n  \n#特性\n\n市面上的weibo nodejs sdk 不少，但是有些是1.0，有些2.0的大部分功能不够完善，用的人少，所以有问题也很少改进。\n\n这个模块是根据weibo-v2.js（[[https://github.com/vzhishu/node-weibo-v2]]）改进而来。有以下改进。\n\n* 支持从本地发图片，也就是upload，目前看到的2.0的nodejs sdk，发现这个功能都没有实现的。我参考一个1.0的框架实现了此功能。\n* 支持url缩短，url缩短需要向sdk传入多个索引名相同的配置属性，js不支持，在此模块中，多个相同索引名的属性，只需要这样传入：\n    <pre>var prefix=\"\"\n    var option={\n        access_token:token\n    }\n    for(var i=0;i<reg_result.length;i++){\n        option[prefix+\"url_long\"]=reg_result[i]\n        prefix+=\"__multi__\"\n    } \n    api.statuses.shorten(option,function(_d){\n       //...                                                \n    })</pre>\n在模块内发出请求之前会把所有的__multi__替换成空，以此实现传入多个相同名字的参数。\n* 原来的weibo-v2.js里面有很多特殊的空字符，导致js完全执行不了，会一直报错，而且很多json的最后都写着逗号，编辑器会一直报错。所以我觉得这个模块挺坑爹的，对这些问题都做了改进，可以正常运行。\n* 错误处理，weibo-v2.js里面不光没有做统一的错误处理，还把返回的json格式打乱了，做了统一处理，每次callback，如果第二个参数存在，就说明api返回了错误，error即为返回的错误json生成的对象。\n\n#使用示例-上传图片和错误处理\n\n<pre>\nvar wb = require('./lib/weibo-v2.js').WeiboApi;\n var opts = {\n   app_key       :  config.weibo_key ,\n   app_secret    :  config.weibo_secret \n};\nvar api = new wb(opts);\n//上传图片\napi.statuses.upload({\n    access_token:token,\n    status:data.content\n},data.pic,function(_d,error){\nif(error){console.log(\" upload error :\"+error);return;}\nconsole.log(\"upload success\")\n})\n</pre>\n\n#授权示例\n以express和weibov2结合来示例：\n\n<pre>\nvar weibo2 = require('weibov2');\nvar express = require('express')\n\nvar app = express();\n//省略express初始化配置若干句\n\nauth = function(req, res) {\n    var opts = {\n        app_key       :  APP_KEY ,\n        app_secret    :  APP_SECRET ,\n        redirect_uri : 'http://'+req.host+':'+PORT+'/sina_auth_cb'\n    };\n    console.log('http://'+req.host+':'+PORT+'/sina_auth_cb')\n    var api = new weibo2.WeiboApi(opts);\n    var auth_url = api.getAuthorizeUrl({\n        redirect_uri : 'http://'+req.host+':'+PORT+'/sina_auth_cb'\n    });\n    console.log(auth_url);\n    res.writeHead(\n        302, \n        {\n            'Location': auth_url\n        }\n        );\n    res.end();    \n};\n\nsina_auth_cb = function(req, res, query_info) {\n    var code = req.query.code;\n    if(!code) {\n        req.session.index_error=\"授权失败，请重试！（code获取失败）\"\n        res.redirect('/');\n        return;\n    };\n    console.log(code)\n    var opts = {\n        app_key       :  APP_KEY ,\n        app_secret    :  APP_SECRET ,\n        'redirect_uri' : 'http://'+req.host+':'+PORT+'/sina_auth_cb'\n    };\n    var api = new weibo2.WeiboApi(opts);\n    api.accessToken(\n    {\n        code : code\n    },\n    function(data) {\n       \n        var access_token=data.access_token\n        api.users.show({\n            uid:data.uid,\n            access_token:data.access_token\n        },function(d){\n            var user=d;\n           \n            console.log(\"oauth success! userid:\"+user.id)\n            //将用户id和用户名存储到cookie，下次无需认证直接可以使用。\n            res.cookie(\"userid\", user.id,{\n                expires: new Date(Date.now() + 604800000), \n                httpOnly: true\n            });\n            res.cookie(\"username\", user.name,{\n                expires: new Date(Date.now() + 604800000), \n                httpOnly: true\n            });\n            //将用户的accesstoken存储到数据库，在后台可以直接用这两个信息发送微博，无需用户参与。\n            //。。。。\n            //认证成功跳转到oauth页面\n            res.redirect('oauth');\n        })   \n    }\n    );\n\n};\n\napp.get(\"/auth\",auth)\napp.get(\"/sina_auth_cb\",sina_auth_cb)\n</pre>",
  "_id": "weibov2@0.9.3",
  "dist": {
    "shasum": "345f9ec60915d91b7b3f9deaeeb0609fa22669d1"
  },
  "_from": "weibov2"
}
