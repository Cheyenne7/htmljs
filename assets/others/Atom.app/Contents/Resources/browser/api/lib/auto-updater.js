// Generated by CoffeeScript 1.6.3
(function() {
  var AutoUpdater, EventEmitter, autoUpdater,
    __slice = [].slice;

  AutoUpdater = process.atomBinding('auto_updater').AutoUpdater;

  EventEmitter = require('events').EventEmitter;

  AutoUpdater.prototype.__proto__ = EventEmitter.prototype;

  autoUpdater = new AutoUpdater;

  autoUpdater.on('update-downloaded-raw', function() {
    var args,
      _this = this;
    args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
    args[3] = new Date(args[3]);
    return this.emit.apply(this, ['update-downloaded'].concat(__slice.call(args), [function() {
      return _this.quitAndInstall();
    }]));
  });

  autoUpdater.quitAndInstall = function() {
    var BrowserWindow, app, win, windows, _i, _len, _results;
    BrowserWindow = require('browser-window');
    windows = BrowserWindow.getAllWindows();
    if (windows.length === 0) {
      AutoUpdater.prototype.quitAndInstall.call(this);
      return;
    }
    app = require('app');
    app.removeAllListeners('window-all-closed');
    app.once('window-all-closed', AutoUpdater.prototype.quitAndInstall.bind(this));
    _results = [];
    for (_i = 0, _len = windows.length; _i < _len; _i++) {
      win = windows[_i];
      _results.push(win.close());
    }
    return _results;
  };

  module.exports = autoUpdater;

}).call(this);
